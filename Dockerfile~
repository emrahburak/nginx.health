 # syntax = docker/dockerfile:1.0-experimental
FROM nginx:latest AS builder

# RUN --mount=type=cache,target=/var/cache/apt --mount=type=cache,target=/var/lib/apt \
RUN apt-get -y update \
	&& apt-get -y install --no-install-recommends \
	binutils  \
	&& rm -rf /var/lib/apt/lists/* \
	&& mkdir app


WORKDIR app

COPY ./requirements.txt /app/requirements.txt
# RUN --mount=type=cache,target=/root/.cache/pip
RUN pip install --upgrade pip setuptools wheel \
	&& pip install --no-cache-dir --user -r /app/requirements.txt


FROM nginx:latest AS app

RUN apt-get -y update \
	&& apt-get -y install --no-install-recommends \
	binutils \
	# && apt-get install -y --no-install-recommends \
	# apt-utils \
	&& rm -rf /var/lib/apt/lists/*

COPY --from=builder  /root/.local /root/.local

ENV PATH=/root/.local/bin:$PATH
ENV PYTHONUNBUFFERED 1
COPY . /app
